const mockData = JSON.parse(
  '{"error":false,"data":[{"subscriptions":{"id":"sub_1QFKaVRun27ngB3Ym7BDvpMh","object":"subscription","application":null,"application_fee_percent":null,"automatic_tax":{"enabled":true,"liability":{"type":"self"}},"billing_cycle_anchor":1730228179,"billing_cycle_anchor_config":null,"billing_thresholds":null,"cancel_at":1738004179,"cancel_at_period_end":false,"canceled_at":1730228179,"cancellation_details":{"comment":null,"feedback":null,"reason":"cancellation_requested"},"collection_method":"charge_automatically","created":1730228179,"currency":"eur","current_period_end":1730919379,"current_period_start":1730832979,"customer":{"id":"cus_R1TTuDnZxJl7UM","object":"customer","address":{"city":"Milano","country":"IT","line1":"Via Gabbro 8","line2":null,"postal_code":"20161","state":"MI"},"balance":0,"created":1728821002,"currency":"eur","default_source":null,"delinquent":false,"description":null,"discount":null,"email":"gio.lamarmora@gmail.com","invoice_prefix":"B446D165","invoice_settings":{"custom_fields":null,"default_payment_method":"pm_1QAEJyRun27ngB3YtMKiwb7F","footer":null,"rendering_options":null},"livemode":false,"metadata":[],"name":"Giovanni Lamarmora","phone":"+393471755045","preferred_locales":["it-IT"],"shipping":null,"tax_exempt":"none","test_clock":null},"days_until_due":null,"default_payment_method":null,"default_source":null,"default_tax_rates":[],"description":null,"discount":null,"discounts":[],"ended_at":null,"invoice_settings":{"account_tax_ids":null,"issuer":{"type":"self"}},"items":{"object":"list","data":[{"id":"si_R7ZjsK0XnWC7XG","object":"subscription_item","billing_thresholds":null,"created":1730228179,"discounts":[],"metadata":[],"plan":{"id":"price_1QFKZwRun27ngB3YQbjqxio1","object":"plan","active":true,"aggregate_usage":null,"amount":2000,"amount_decimal":"2000","billing_scheme":"per_unit","created":1730228144,"currency":"eur","interval":"day","interval_count":1,"livemode":false,"metadata":[],"meter":null,"nickname":null,"product":"prod_R7Zj9QQAsCh4JU","tiers_mode":null,"transform_usage":null,"trial_period_days":null,"usage_type":"licensed"},"price":{"id":"price_1QFKZwRun27ngB3YQbjqxio1","object":"price","active":true,"billing_scheme":"per_unit","created":1730228144,"currency":"eur","custom_unit_amount":null,"livemode":false,"lookup_key":null,"metadata":[],"nickname":null,"product":"prod_R7Zj9QQAsCh4JU","recurring":{"aggregate_usage":null,"interval":"day","interval_count":1,"meter":null,"trial_period_days":null,"usage_type":"licensed"},"tax_behavior":"unspecified","tiers_mode":null,"transform_quantity":null,"type":"recurring","unit_amount":2000,"unit_amount_decimal":"2000"},"quantity":1,"subscription":"sub_1QFKaVRun27ngB3Ym7BDvpMh","tax_rates":[]}],"has_more":false,"total_count":1,"url":"/v1/subscription_items?subscription=sub_1QFKaVRun27ngB3Ym7BDvpMh"},"latest_invoice":"in_1QHrvaRun27ngB3YFqmue0HG","livemode":false,"metadata":[],"next_pending_invoice_item_invoice":null,"on_behalf_of":null,"pause_collection":null,"payment_settings":{"payment_method_options":null,"payment_method_types":null,"save_default_payment_method":null},"pending_invoice_item_interval":null,"pending_setup_intent":null,"pending_update":null,"plan":{"id":"price_1QFKZwRun27ngB3YQbjqxio1","object":"plan","active":true,"aggregate_usage":null,"amount":2000,"amount_decimal":"2000","billing_scheme":"per_unit","created":1730228144,"currency":"eur","interval":"day","interval_count":1,"livemode":false,"metadata":[],"meter":null,"nickname":null,"product":"prod_R7Zj9QQAsCh4JU","tiers_mode":null,"transform_usage":null,"trial_period_days":null,"usage_type":"licensed"},"quantity":1,"schedule":"sub_sched_1QFKaVRun27ngB3YVffrMmxQ","start_date":1730228179,"status":"active","test_clock":null,"transfer_data":null,"trial_end":null,"trial_settings":{"end_behavior":{"missing_payment_method":"create_invoice"}},"trial_start":null},"product":{"id":"prod_R7Zj9QQAsCh4JU","object":"product","active":true,"attributes":[],"created":1730228144,"default_price":"price_1QFKZwRun27ngB3YQbjqxio1","description":null,"images":[],"livemode":false,"marketing_features":[],"metadata":{"durata_minima":"3"},"name":"prova giorno cancellazione","package_dimensions":null,"shippable":null,"statement_descriptor":null,"tax_code":"txcd_10000000","type":"service","unit_label":null,"updated":1730228145,"url":null}},{"subscriptions":{"id":"sub_1QFKR5Run27ngB3YCyevtkEu","object":"subscription","application":null,"application_fee_percent":null,"automatic_tax":{"enabled":true,"liability":{"type":"self"}},"billing_cycle_anchor":1730227595,"billing_cycle_anchor_config":null,"billing_thresholds":null,"cancel_at":null,"cancel_at_period_end":false,"canceled_at":null,"cancellation_details":{"comment":null,"feedback":null,"reason":null},"collection_method":"charge_automatically","created":1730227595,"currency":"eur","current_period_end":1730918795,"current_period_start":1730832395,"customer":{"id":"cus_R1TTuDnZxJl7UM","object":"customer","address":{"city":"Milano","country":"IT","line1":"Via Gabbro 8","line2":null,"postal_code":"20161","state":"MI"},"balance":0,"created":1728821002,"currency":"eur","default_source":null,"delinquent":false,"description":null,"discount":null,"email":"gio.lamarmora@gmail.com","invoice_prefix":"B446D165","invoice_settings":{"custom_fields":null,"default_payment_method":"pm_1QAEJyRun27ngB3YtMKiwb7F","footer":null,"rendering_options":null},"livemode":false,"metadata":[],"name":"Giovanni Lamarmora","phone":"+393471755045","preferred_locales":["it-IT"],"shipping":null,"tax_exempt":"none","test_clock":null},"days_until_due":null,"default_payment_method":null,"default_source":null,"default_tax_rates":[],"description":null,"discount":null,"discounts":[],"ended_at":null,"invoice_settings":{"account_tax_ids":null,"issuer":{"type":"self"}},"items":{"object":"list","data":[{"id":"si_R7ZaTMoh7yQtwS","object":"subscription_item","billing_thresholds":null,"created":1730227595,"discounts":[],"metadata":[],"plan":{"id":"price_1QFKPcRun27ngB3YKyruei0L","object":"plan","active":true,"aggregate_usage":null,"amount":1000,"amount_decimal":"1000","billing_scheme":"per_unit","created":1730227504,"currency":"eur","interval":"day","interval_count":1,"livemode":false,"metadata":[],"meter":null,"nickname":null,"product":"prod_R7ZYepnA7Wsp3b","tiers_mode":null,"transform_usage":null,"trial_period_days":null,"usage_type":"licensed"},"price":{"id":"price_1QFKPcRun27ngB3YKyruei0L","object":"price","active":true,"billing_scheme":"per_unit","created":1730227504,"currency":"eur","custom_unit_amount":null,"livemode":false,"lookup_key":null,"metadata":[],"nickname":null,"product":"prod_R7ZYepnA7Wsp3b","recurring":{"aggregate_usage":null,"interval":"day","interval_count":1,"meter":null,"trial_period_days":null,"usage_type":"licensed"},"tax_behavior":"unspecified","tiers_mode":null,"transform_quantity":null,"type":"recurring","unit_amount":1000,"unit_amount_decimal":"1000"},"quantity":1,"subscription":"sub_1QFKR5Run27ngB3YCyevtkEu","tax_rates":[]}],"has_more":false,"total_count":1,"url":"/v1/subscription_items?subscription=sub_1QFKR5Run27ngB3YCyevtkEu"},"latest_invoice":"in_1QHrmsRun27ngB3Ynvh6AUAP","livemode":false,"metadata":[],"next_pending_invoice_item_invoice":null,"on_behalf_of":null,"pause_collection":null,"payment_settings":{"payment_method_options":null,"payment_method_types":null,"save_default_payment_method":"off"},"pending_invoice_item_interval":null,"pending_setup_intent":null,"pending_update":null,"plan":{"id":"price_1QFKPcRun27ngB3YKyruei0L","object":"plan","active":true,"aggregate_usage":null,"amount":1000,"amount_decimal":"1000","billing_scheme":"per_unit","created":1730227504,"currency":"eur","interval":"day","interval_count":1,"livemode":false,"metadata":[],"meter":null,"nickname":null,"product":"prod_R7ZYepnA7Wsp3b","tiers_mode":null,"transform_usage":null,"trial_period_days":null,"usage_type":"licensed"},"quantity":1,"schedule":"sub_sched_1QFKW2Run27ngB3Yi97G8xox","start_date":1730227595,"status":"active","test_clock":null,"transfer_data":null,"trial_end":null,"trial_settings":{"end_behavior":{"missing_payment_method":"create_invoice"}},"trial_start":null},"product":{"id":"prod_R7ZYepnA7Wsp3b","object":"product","active":true,"attributes":[],"created":1730227503,"default_price":"price_1QFKPcRun27ngB3YKyruei0L","description":null,"images":[],"livemode":false,"marketing_features":[],"metadata":[],"name":"test giorno","package_dimensions":null,"shippable":null,"statement_descriptor":null,"tax_code":"txcd_10000000","type":"service","unit_label":null,"updated":1730227517,"url":null}},{"subscriptions":{"id":"sub_1QCmC3Run27ngB3YPzVCyjpq","object":"subscription","application":null,"application_fee_percent":null,"automatic_tax":{"enabled":true,"liability":{"type":"self"}},"billing_cycle_anchor":1729619311,"billing_cycle_anchor_config":null,"billing_thresholds":null,"cancel_at":null,"cancel_at_period_end":false,"canceled_at":null,"cancellation_details":{"comment":null,"feedback":null,"reason":null},"collection_method":"charge_automatically","created":1729619311,"currency":"eur","current_period_end":1732297711,"current_period_start":1729619311,"customer":{"id":"cus_R1TTuDnZxJl7UM","object":"customer","address":{"city":"Milano","country":"IT","line1":"Via Gabbro 8","line2":null,"postal_code":"20161","state":"MI"},"balance":0,"created":1728821002,"currency":"eur","default_source":null,"delinquent":false,"description":null,"discount":null,"email":"gio.lamarmora@gmail.com","invoice_prefix":"B446D165","invoice_settings":{"custom_fields":null,"default_payment_method":"pm_1QAEJyRun27ngB3YtMKiwb7F","footer":null,"rendering_options":null},"livemode":false,"metadata":[],"name":"Giovanni Lamarmora","phone":"+393471755045","preferred_locales":["it-IT"],"shipping":null,"tax_exempt":"none","test_clock":null},"days_until_due":null,"default_payment_method":null,"default_source":null,"default_tax_rates":[],"description":null,"discount":null,"discounts":[],"ended_at":null,"invoice_settings":{"account_tax_ids":null,"issuer":{"type":"self"}},"items":{"object":"list","data":[{"id":"si_R4w4zAJHa0WypV","object":"subscription_item","billing_thresholds":null,"created":1729619312,"discounts":[],"metadata":[],"plan":{"id":"price_1Q5WmqRun27ngB3YDjxO7NvU","object":"plan","active":true,"aggregate_usage":null,"amount":2500,"amount_decimal":"2500","billing_scheme":"per_unit","created":1727891792,"currency":"eur","interval":"month","interval_count":1,"livemode":false,"metadata":[],"meter":null,"nickname":null,"product":"prod_QxRg7AKRVV7jJC","tiers_mode":null,"transform_usage":null,"trial_period_days":null,"usage_type":"licensed"},"price":{"id":"price_1Q5WmqRun27ngB3YDjxO7NvU","object":"price","active":true,"billing_scheme":"per_unit","created":1727891792,"currency":"eur","custom_unit_amount":null,"livemode":false,"lookup_key":null,"metadata":[],"nickname":null,"product":"prod_QxRg7AKRVV7jJC","recurring":{"aggregate_usage":null,"interval":"month","interval_count":1,"meter":null,"trial_period_days":null,"usage_type":"licensed"},"tax_behavior":"exclusive","tiers_mode":null,"transform_quantity":null,"type":"recurring","unit_amount":2500,"unit_amount_decimal":"2500"},"quantity":1,"subscription":"sub_1QCmC3Run27ngB3YPzVCyjpq","tax_rates":[]}],"has_more":false,"total_count":1,"url":"/v1/subscription_items?subscription=sub_1QCmC3Run27ngB3YPzVCyjpq"},"latest_invoice":"in_1QCmVQRun27ngB3YNCQ1N10p","livemode":false,"metadata":[],"next_pending_invoice_item_invoice":null,"on_behalf_of":null,"pause_collection":null,"payment_settings":{"payment_method_options":null,"payment_method_types":null,"save_default_payment_method":"off"},"pending_invoice_item_interval":null,"pending_setup_intent":null,"pending_update":null,"plan":{"id":"price_1Q5WmqRun27ngB3YDjxO7NvU","object":"plan","active":true,"aggregate_usage":null,"amount":2500,"amount_decimal":"2500","billing_scheme":"per_unit","created":1727891792,"currency":"eur","interval":"month","interval_count":1,"livemode":false,"metadata":[],"meter":null,"nickname":null,"product":"prod_QxRg7AKRVV7jJC","tiers_mode":null,"transform_usage":null,"trial_period_days":null,"usage_type":"licensed"},"quantity":1,"schedule":null,"start_date":1729619311,"status":"active","test_clock":null,"transfer_data":null,"trial_end":null,"trial_settings":{"end_behavior":{"missing_payment_method":"create_invoice"}},"trial_start":null},"product":{"id":"prod_QxRg7AKRVV7jJC","object":"product","active":true,"attributes":[],"created":1727891791,"default_price":"price_1Q5WmqRun27ngB3YDjxO7NvU","description":"Neverland - Symposium - KizMi - KIMA","images":[],"livemode":false,"marketing_features":[],"metadata":[],"name":"All You Can Dance - Italy","package_dimensions":null,"shippable":null,"statement_descriptor":null,"tax_code":"txcd_10000000","type":"service","unit_label":null,"updated":1727891792,"url":null}}]}'
);

document.addEventListener("DOMContentLoaded", function () {
  const urlParams = new URLSearchParams(window.location.search);
  const data = urlParams.get("data");

  if (data) {
    // Decodifica il dato da base64
    const decodedData = atob(data); // Decodifica base64
    const [customer_id, session_id] = decodedData.split(":"); // Supponiamo che siano separati da ':'

    // Rimuovi il parametro 'data' dall'URL
    //const cleanUrl = window.location.origin + window.location.pathname;
    //window.history.replaceState(null, "", cleanUrl);

    // Invia i dati a PHP
    fetch("resume.php", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({ customer_id, session_id }),
    })
      .then((response) => response.json())
      .then((data) => {
        if (data.error) {
          console.error(data.message);
          // Gestisci l'errore (es. mostra un messaggio all'utente)
        } else {
          // Gestisci i dati delle sottoscrizioni ricevuti
          console.log(data);
          // Potresti anche generare un QR Code qui se necessario
        }
      })
      .catch((error) =>
        errorDialog("Errore", "Errore nella richiesta:", error)
      );
  } else {
    errorDialog("Errore", "Si è verificato un problema, riprova più tardi.");
  }
});

function checkAndMapData(data) {}
